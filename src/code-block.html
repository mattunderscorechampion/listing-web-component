<script src="//cdn.jsdelivr.net/highlight.js/9.4.0/highlight.min.js"></script>
<template id="x-code-block-template">
    <style>
        @import "//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css"
    </style>
    <pre style="text-align: left; font-size: 10pt; border: 1px solid grey;"><code></code></pre>
    <span class="hljs-title">A title</span>
</template>
<script>
(function() {
    if (!document.registerElement) {
        return;
    }
    var templateDoc = document.currentScript.ownerDocument;

    var CodeBlockProto = Object.create(HTMLElement.prototype);

    CodeBlockProto.createdCallback = function() {
        var dataSrc = this.getAttribute('data-src');
        var gistElement = this;

        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            var httpResponse = this;
            var DONE = httpResponse.DONE || 4;
            if (httpResponse.readyState === DONE) {
                var shadow = gistElement.createShadowRoot();

                var template = templateDoc.querySelector('#x-code-block-template');
                var clone = template.content.cloneNode(true);

                var pre = clone.childNodes[3];
                var code = pre.childNodes[0];
                code.innerHTML = httpResponse.responseText;
                hljs.highlightBlock(code);

                shadow.appendChild(document.importNode(clone, true));
            }
        };
        request.open('GET', dataSrc, true);
        request.send(null);
    };

    document.registerElement('x-code-block', {
        prototype: CodeBlockProto
    });
})();
</script>
